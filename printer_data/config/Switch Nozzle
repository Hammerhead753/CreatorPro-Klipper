[gcode_macro SWITCH_NOZZLE]
description: Switch between extruder 0 and extruder 1, cooling inactive nozzle and waiting for active nozzle
# Usage: SWITCH_NOZZLE EXTRUDER=<0 or 1> TEMP=<target temp> [STANDBY=<temp>]
# Example: SWITCH_NOZZLE EXTRUDER=1 TEMP=210 STANDBY=60
variable_extruder: 0
variable_temp: 0
variable_standby: 50
gcode:
    {% set active = params.EXTRUDER|int %}
    {% set target_temp = params.TEMP|int %}
    {% set standby_temp = params.STANDBY|default(50)|int %}
    
    # Validate input
    {% if active != 0 and active != 1 %}
        {action_respond_info("Invalid EXTRUDER value. Use 0 or 1.")}
        {% exit %}
    {% endif %}
    
    # Store variables
    SET_GCODE_VARIABLE MACRO=SWITCH_NOZZLE VARIABLE=extruder VALUE={active}
    SET_GCODE_VARIABLE MACRO=SWITCH_NOZZLE VARIABLE=temp VALUE={target_temp}
    SET_GCODE_VARIABLE MACRO=SWITCH_NOZZLE VARIABLE=standby VALUE={standby_temp}
    
    # Cool inactive nozzle and heat active nozzle
    {% if active == 0 %}
        M104 T1 S{standby_temp}      ; Cool extruder 1
        M109 T0 S{target_temp}       ; Heat extruder 0 and wait
        T0                           ; Select extruder 0
    {% else %}
        M104 T0 S{standby_temp}      ; Cool extruder 0
        M109 T1 S{target_temp}       ; Heat extruder 1 and wait
        T1                           ; Select extruder 1
    {% endif %}
